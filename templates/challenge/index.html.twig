{% extends 'base.html.twig' %}
{% block page_id %}challenges{% endblock %}
{% block title %}D√©fis{% endblock %}

{% block body %}

    <h1 class="fw-bold mb-3">‚öîÔ∏è Les D√©fis du Village</h1>

    {# Barre d‚Äôoutils #}
    <div class="toolbar mb-3">
        <div class="input-group" style="max-width:420px;">
            <span class="input-group-text">üîé</span>
            <input id="challengeSearch" class="form-control" placeholder="Rechercher un d√©fi‚Ä¶ (titre/description)">
        </div>

        <select id="challengeSort" class="form-select input-pill" aria-label="Trier" style="max-width:220px;">
            <option value="points-desc">Tri : Points ‚Üì</option>
            <option value="points-asc">Tri : Points ‚Üë</option>
            <option value="alpha">Tri : A ‚Üí Z</option>
        </select>

        <div class="d-flex align-items-center gap-2 flex-wrap">
            <label for="pointsMin" class="form-label m-0">Points mini :</label>
            <input type="range" id="pointsMin" class="form-range" min="{{ minPoints }}" max="{{ maxPoints }}" value="{{ minPoints }}" style="width:180px;">
            <span id="pointsMinValue" class="badge bg-primary">{{ minPoints }}</span>
        </div>
    </div>

    {# Filtres cat√©gories #}
    <div class="category-filter btn-group mb-3" role="group" aria-label="Filtrer par cat√©gorie">
        <input type="radio" class="btn-check" name="cat" id="cat-all" value="all" checked>
        <label class="btn btn-outline-secondary" for="cat-all">Toutes</label>
        {% for c in cats %}
            <input type="radio" class="btn-check" name="cat" id="cat-{{ c|lower|replace({' ':'-'}) }}" value="{{ c }}">
            <label class="btn btn-outline-secondary" for="cat-{{ c|lower|replace({' ':'-'}) }}">{{ c }}</label>
        {% endfor %}
    </div>

    {# R√©sum√© r√©sultats #}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <span id="resultCount" class="badge bg-info">0</span>
            <span class="text-muted ms-2">d√©fi(s) affich√©(s)</span>
        </div>
        <a href="#top" class="smooth btn btn-outline-secondary btn-sm">‚Üë Haut de page</a>
    </div>

    {# Liste #}
    <div id="top"></div>
    <div class="row" data-challenges>
        {% for c in challenges %}
            <div class="col-md-4 mb-4 reveal"
                 data-item
                 data-title="{{ c.title }}"
                 data-desc="{{ c.description }}"
                 data-points="{{ c.points }}"
                 data-cat="{{ c.category }}">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h4 class="mb-0">{{ c.title }}</h4>
                            {% if c.level %}
                                {% set badge =
                                    c.level == 'Facile' ? 'success' :
                                    (c.level == 'Moyen' ? 'warning' :
                                    (c.level == 'Difficile' ? 'danger' : 'secondary'))
                                %}
                                <span class="badge bg-{{ badge }}">{{ c.level }}</span>
                            {% endif %}
                        </div>
                        <p class="text-muted">{{ c.description }}</p>

                        <div class="mt-auto d-flex justify-content-between align-items-center">
                            <span class="badge bg-success">{{ c.points }} pts</span>
                            <span class="tag">{{ c.category }}</span>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0 pt-0">
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary flex-grow-1" data-challenge-action="start">D√©marrer</button>
                            <button class="btn btn-outline-secondary" data-challenge-action="save">üìå Sauver</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    {# Message aucun r√©sultat #}
    <div id="noResults" class="alert alert-warning d-none">
        Aucun d√©fi ne correspond √† vos filtres. Essayez d‚Äô√©largir votre recherche.
    </div>

{% endblock %}
